#!/usr/bin/env bash
set -euo pipefail
ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

cmd="${1:-help}"
shift || true

case "$cmd" in
  task)
    title="${1:-}"; scope="${2:-}"; desc="${3:-quick task}"; lane="${4:-A}"
    if [[ -z "$title" || -z "$scope" ]]; then
      echo "Usage: ./bw task \"title\" \"scope\" [desc] [lane]"
      exit 1
    fi
    "$ROOT/.clawdbot/scripts/submit-task.sh" --title "$title" --scope "$scope" --desc "$desc" --lane "$lane"
    ;;
  status|s)
    "$ROOT/.clawdbot/scripts/ops-digest.sh"
    ;;
  tick|run)
    "$ROOT/.clawdbot/scripts/swarm-start.sh"
    ;;
  morning)
    "$ROOT/.clawdbot/scripts/morning-brief.sh"
    ;;
  approve)
    "$ROOT/.clawdbot/scripts/ideas-manage.sh" approve "$@"
    ;;
  deny)
    "$ROOT/.clawdbot/scripts/ideas-manage.sh" deny "$@"
    ;;
  defer)
    "$ROOT/.clawdbot/scripts/ideas-manage.sh" defer "$@"
    ;;
  help|*)
    cat <<'EOF'
Brain-web quick commands

  ./bw task "title" "scope" [desc] [lane]   Submit + dispatch task
  ./bw status                                  Show digest
  ./bw tick                                    Run one swarm cycle now
  ./bw morning                                 Morning brief with proposed tasks
  ./bw approve <idx...>                        Approve idea indexes + dispatch
  ./bw deny <idx...>                           Mark idea indexes denied
  ./bw defer <idx...>                          Mark idea indexes deferred
EOF
    ;;
esac
